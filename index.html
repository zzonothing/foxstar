<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>캐릭터 스탯 테이블</title>
    <style>
        table {
            width: 90%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid #ccc;
        }

        th, td {
            padding: 8px;
            text-align: center;
        }
    </style>
</head>

<body>
    <h1>캐릭터 스탯 조회</h1>

    <!-- 멤버 선택 드롭다운 -->
    <label for="memberSelect">멤버 선택: </label>
    <select id="memberSelect">
        <option value="">-- 전체 멤버 --</option>
    </select>

    <!-- 캐릭터 선택 드롭다운 -->
    <label for="characterSelect">캐릭터 선택: </label>
    <select id="characterSelect">
        <option value="">-- 전체 캐릭터 --</option>
    </select>

    <!-- 정렬 기준 선택 드롭다운 -->
    <label for="sortSelect">정렬 기준: </label>
    <select id="sortSelect">
        <option value="elementPower">우코 파워</option>
        <option value="nonElementPower">비우코 파워</option>
        <option value="elementPlusAtk">우코+공증</option>
        <option value="increaseElementDamage">우코</option>
        <option value="increaseAtk">공증</option>
    </select>

    <!-- 스탯 출력 테이블 -->
    <table id="statsTable">
        <thead>
            <tr>
                <th>순위</th>
                <th>멤버</th>
                <th>캐릭터</th>
                <th>우코 파워</th>
                <th>비우코 파워</th>
                <th>우코+공증</th>
                <th>우코</th>
                <th>공증</th>
                <th>공격력</th>
                <th>스킬1</th>
                <th>스킬2</th>
                <th>스킬3</th>
            </tr>
        </thead>
        <tbody>
            <!-- JavaScript로 동적 생성 -->
        </tbody>
    </table>

    <script>
        // JSON 데이터 불러오기
        fetch('data/data.json')
            .then(response => response.json())
            .then(data => {
                const members = data.members;
                const selectMember = document.getElementById('memberSelect');
                const selectCharacter = document.getElementById('characterSelect');
                const selectSort = document.getElementById('sortSelect');
                const tbody = document.getElementById('statsTable').querySelector('tbody');

                // 멤버 이름 및 캐릭터 이름 저장
                const memberNamesSet = new Set();
                const characterNamesSet = new Set();

                // 모든 멤버 및 캐릭터 목록 수집
                members.forEach(member => {
                    memberNamesSet.add(member.name);
                    member.Characters.forEach(character => {
                        characterNamesSet.add(character.name);
                    });
                });

                // 멤버 선택 드롭다운에 추가
                Array.from(memberNamesSet).sort().forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    selectMember.appendChild(option);
                });

                // 캐릭터 선택 드롭다운에 추가
                Array.from(characterNamesSet).sort().forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    selectCharacter.appendChild(option);
                });

                // 테이블 업데이트 함수
                function updateTable() {
                    const selectedMember = selectMember.value;
                    const selectedCharacter = selectCharacter.value;
                    const sortBy = selectSort.value;
                    tbody.innerHTML = ''; // 기존 테이블 내용 초기화

                    let filteredCharacters = [];

                    // 멤버 및 캐릭터 필터링
                    members.forEach(member => {
                        if (selectedMember && member.name !== selectedMember) return;

                        member.Characters.forEach(character => {
                            if (selectedCharacter && character.name !== selectedCharacter) return;

                            // 스탯 계산
                            const elementPower = Math.round(character.atk * (1 + character.increaseAtk / 100) * (1 + character.increaseElementDamage / 100));
                            const nonElementPower = Math.round(character.atk * (1 + character.increaseAtk / 100));
                            const elementPlusAtk = Math.round((character.increaseElementDamage + character.increaseAtk) * 100) / 100;

                            filteredCharacters.push({
                                memberName: member.name,
                                characterName: character.name,
                                elementPower: elementPower,
                                nonElementPower: nonElementPower,
                                elementPlusAtk: elementPlusAtk,
                                increaseElementDamage: character.increaseElementDamage,
                                increaseAtk: character.increaseAtk,
                                atk: character.atk,
                                skill1: character.skill1,
                                skill2: character.skill2,
                                skill3: character.skill3
                            });
                        });
                    });

                    // 선택된 정렬 기준에 맞게 정렬
                    filteredCharacters.sort((a, b) => b[sortBy] - a[sortBy]);

                    // 정렬된 데이터로 테이블 생성 (순위 추가)
                    filteredCharacters.forEach((character, index) => {
                        const tr = document.createElement('tr');

                        // 순위 추가 (1부터 시작)
                        const tdRank = document.createElement('td');
                        tdRank.textContent = index + 1;
                        tr.appendChild(tdRank);

                        // 멤버 이름
                        const tdMember = document.createElement('td');
                        tdMember.textContent = character.memberName;
                        tr.appendChild(tdMember);

                        // 캐릭터 이름
                        const tdCharacter = document.createElement('td');
                        tdCharacter.textContent = character.characterName;
                        tr.appendChild(tdCharacter);

                        // 우코 파워
                        const tdElementPower = document.createElement('td');
                        tdElementPower.textContent = character.elementPower;
                        tr.appendChild(tdElementPower);

                        // 비우코 파워
                        const tdNonElementPower = document.createElement('td');
                        tdNonElementPower.textContent = character.nonElementPower;
                        tr.appendChild(tdNonElementPower);

                        // 우코+공증
                        const tdElementPlusAtk = document.createElement('td');
                        tdElementPlusAtk.textContent = character.elementPlusAtk;
                        tr.appendChild(tdElementPlusAtk);

                        // 우코
                        const tdIncreaseElementDamage = document.createElement('td');
                        tdIncreaseElementDamage.textContent = character.increaseElementDamage;
                        tr.appendChild(tdIncreaseElementDamage);

                        // 공증
                        const tdIncreaseAtk = document.createElement('td');
                        tdIncreaseAtk.textContent = character.increaseAtk;
                        tr.appendChild(tdIncreaseAtk);

                        // ATK
                        const tdAtk = document.createElement('td');
                        tdAtk.textContent = character.atk;
                        tr.appendChild(tdAtk);

                        tbody.appendChild(tr);
                    });
                }

                // 필터 변경 시 테이블 업데이트
                selectMember.addEventListener('change', updateTable);
                selectCharacter.addEventListener('change', updateTable);
                selectSort.addEventListener('change', updateTable);

                // 페이지 로드 시 초기 테이블 표시
                updateTable();
            })
            .catch(error => console.error('JSON 파일 로딩 중 오류:', error));
    </script>
</body>
</html>
