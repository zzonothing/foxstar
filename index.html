<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>캐릭터 스탯 테이블</title>
    <style>
        table {
            width: 90%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        th, td {
            padding: 8px;
            text-align: center;
        }
    </style>
</head>

<body>
    <h1>캐릭터 스탯 조회</h1>

    <label for="memberSelect">멤버 선택: </label>
    <select id="memberSelect">
        <option value="">-- 선택하세요 --</option>
    </select>

    <label for="characterSelect">캐릭터 선택: </label>
    <select id="characterSelect">
        <option value="">-- 선택하세요 --</option>
    </select>

    <label for="sortSelect">정렬 기준: </label>
    <select id="sortSelect">
        <option value="elementPower">우코 파워</option>
        <option value="nonElementPower">비우코 파워</option>
        <option value="elementPlusAtk">우코x공증</option>
        <option value="increaseElementDamage">우코</option>
        <option value="increaseAtk">공증</option>
    </select>

    <table id="statsTable">
        <thead>
            <tr>
                <th>순위</th>
                <th>닉네임</th>
                <th>캐릭터</th>
                <th>우코 파워</th>
                <th>비우코 파워</th>
                <th>우코x공증</th>
                <th>우코</th>
                <th>공증</th>
                <th>공격력</th>
                <th>스킬1</th>
                <th>스킬2</th>
                <th>스킬3</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        fetch('data/data.json')
            .then(response => response.json())
            .then(data => {
                const members = data.members;
                const memberSelect = document.getElementById('memberSelect');
                const characterSelect = document.getElementById('characterSelect');
                const sortSelect = document.getElementById('sortSelect');
                const tbody = document.getElementById('statsTable').querySelector('tbody');
                
                const memberNames = [...new Set(members.map(m => m.name))].sort();
                memberNames.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    memberSelect.appendChild(option);
                });
                
                const characterNames = new Set();
                members.forEach(m => m.Characters.forEach(c => characterNames.add(c.name)));
                Array.from(characterNames).sort().forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    characterSelect.appendChild(option);
                });

                function updateTable() {
                    const selectedMember = memberSelect.value;
                    const selectedCharacter = characterSelect.value;
                    const sortBy = sortSelect.value;
                    tbody.innerHTML = '';
                    
                    let filteredData = [];
                    members.forEach(member => {
                        if (!selectedMember || member.name === selectedMember) {
                            member.Characters.forEach(character => {
                                if (!selectedCharacter || character.name === selectedCharacter) {
                                    filteredData.push({
                                        memberName: member.name,
                                        characterName: character.name,
                                        elementPower: Math.round(character.atk * (1 + character.increaseAtk / 100) * (1 + character.increaseElementDamage / 100)),
                                        nonElementPower: Math.round(character.atk * (1 + character.increaseAtk / 100)),
                                        elementPlusAtk: Math.round(((1 + character.increaseAtk / 100) * (1 + character.increaseElementDamage / 100) - 1) * 10000) / 100,
                                        increaseElementDamage: character.increaseElementDamage,
                                        increaseAtk: character.increaseAtk,
                                        atk: character.atk,
                                        skill1: character.skill1,
                                        skill2: character.skill2,
                                        skill3: character.skill3
                                    });
                                }
                            });
                        }
                    });

                    filteredData.sort((a, b) => b[sortBy] - a[sortBy]);
                    
                    filteredData.forEach((character, index) => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${character.memberName}</td>
                            <td>${character.characterName}</td>
                            <td>${character.elementPower}</td>
                            <td>${character.nonElementPower}</td>
                            <td>${character.elementPlusAtk}</td>
                            <td>${character.increaseElementDamage}</td>
                            <td>${character.increaseAtk}</td>
                            <td>${character.atk}</td>
                            <td>${character.skill1}</td>
                            <td>${character.skill2}</td>
                            <td>${character.skill3}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
                
                memberSelect.addEventListener('change', updateTable);
                characterSelect.addEventListener('change', updateTable);
                sortSelect.addEventListener('change', updateTable);
            })
            .catch(error => console.error('JSON 파일 로딩 중 오류:', error));
    </script>
</body>
</html>
