<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>ìºë¦­í„° ìŠ¤íƒ¯ í…Œì´ë¸”</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            background-color: #f9f9f9;
            color: #333;
            margin: 0;
            padding: 20px;
        }
    
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
    
        div {
            margin-bottom: 20px;
            text-align: center;
        }
    
        label {
            margin-right: 8px;
            font-weight: 600;
        }
    
        select {
            padding: 8px 12px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: border-color 0.3s;
        }
    
        select:focus {
            border-color: #3498db;
            outline: none;
        }
    
        table {
            width: 95%;
            margin: 0 auto;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
    
        th,
        td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
    
        th {
            background-color: #3498db;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }
    
        tr:hover {
            background-color: #f1f7ff;
        }
    
        tbody tr:last-child td {
            border-bottom: none;
        }
    
        .character-image {
            width: 64px;
            height: 64px;
            border-radius: 25%;
            vertical-align: middle;
        }
    
        .character-name {
            display: block;
            font-size: 12px;
            margin-top: 4px;
        }

        #deckDamageInput {
            width: 120px;
            padding: 8px 12px;
            margin-left: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: border-color 0.3s;
            /* ìŠ¤í•€ ë²„íŠ¼ ìˆ¨ê¸°ê¸° */
            -moz-appearance: textfield;
        }
        #deckDamageInput:focus {
            border-color: #3498db;
            outline: none;
        }
        /* Chrome, Safari, Edge, Operaì—ì„œ ìŠ¤í•€ ë²„íŠ¼ ìˆ¨ê¸°ê¸° */
        #deckDamageInput::-webkit-outer-spin-button,
        #deckDamageInput::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .item-grade-SSR {
            color: #FFD700;
        }
        .item-grade-SR {
            color: #A259FF;
        }
        .item-grade-R {
            color: #3498db;
        }
    </style>
</head>

<body>
    <div>
        <label for="seasonSelect">ì‹œì¦Œ ì„ íƒ: </label>
        <select id="seasonSelect"></select>
    </div>
    <div>
        <!-- ë± ì„ íƒ: ë± ëª¨ë“œ ì „í™˜ (ì˜µì…˜ í…ìŠ¤íŠ¸ëŠ” 'ì‹ ìˆ˜í´') -->
        <label for="deckSelect">ë± ì„ íƒ: </label>
        <select id="deckSelect">
            <option value="">-- ë± ì„ íƒ --</option>
            <option value="deck1">ì‹ ë° ìˆ˜ë‹ˆìŠ¤ í´ì´ë“ </option>
            <option value="deck2">í‘ì˜ ì•¨ë¦¬ìŠ¤ (í’ì••)</option>
            <option value="deck3">í‘ì˜ í’ìŠ¤ì¹´</option>
            <option value="deck4">ë ˆí›„ ë§¥ìŠ¤ì›°</option>
            <option value="deck5">ë ˆí›„ ë¼í”¼</option>
            <option value="deck6">ë¼í”¼ ëª¨ë”</option>
            <!-- <option value="deck7">ë¼í”¼ ì•¨ë¦¬ìŠ¤</option> -->
            <!-- <option value="deck8">ì•„ìŠ¤ì¹´ ë ˆì´ ëª¨ë”</option> -->
            <option value="deck9">í—¬ë¦„ í´ë£¨ë“œ</option>
        </select>
        <select id="deckMemberSelect" style="margin-left:10px;"></select>
        <input id="deckDamageInput" type="number" placeholder="ì˜ˆìƒ ëŒ€ë¯¸ì§€" style="width:100px; margin-left:5px;">
    </div>
    <div>
        <!-- ê°œë³„ ëª¨ë“œìš© ë“œë¡­ë‹¤ìš´ -->
        <label for="characterSelect">ìºë¦­í„° ì„ íƒ: </label>
        <select id="characterSelect">
            <option value="">-- ì „ì²´ ìºë¦­í„° --</option>
        </select>
    
        <label for="memberSelect">ë©¤ë²„ ì„ íƒ: </label>
        <select id="memberSelect">
            <option value="">-- ì „ì²´ ë©¤ë²„ --</option>
        </select>
    
        <!-- ì •ë ¬ ê¸°ì¤€ (ê°œë³„ ëª¨ë“œì— ì ìš©, ë± ëª¨ë“œì—ì„œëŠ” ë± íŒŒì›Œ ê¸°ì¤€ ì •ë ¬) -->
        <label for="sortSelect">ì •ë ¬ ê¸°ì¤€: </label>
        <select id="sortSelect">
            <option value="trainingLevel">ìœ¡ì„±</option>            
            <option value="elementPower">ìš°ì½” íŒŒì›Œ</option>
            <option value="nonElementPower">ë¹„ìš°ì½” íŒŒì›Œ</option>
            <option value="elementPlusAtk">ìš°ì½”xê³µì¦</option>
            <option value="increaseElementDamage">ìš°ì½”</option>
            <option value="increaseAtk">ê³µì¦</option>
        </select>
    </div>

    <!-- ìŠ¤íƒ¯ ì¶œë ¥ í…Œì´ë¸” -->
    <table id="statsTable">
        <thead id="tableHeader">
            <!-- ê¸°ë³¸ ê°œë³„ ëª¨ë“œ í—¤ë” (ë± ëª¨ë“œê°€ ì•„ë‹ ê²½ìš°) -->
            <tr>
                <th>ìˆœìœ„</th>
                <th class="nickname-col">ë‹‰ë„¤ì„</th>
                <th class="character-col">ìºë¦­í„°</th>
                <th>ìš°ì½” íŒŒì›Œ</th>
                <th>ë¹„ìš°ì½” íŒŒì›Œ</th>
                <th>ìš°ì½”xê³µì¦</th>
                <th>ìš°ì½”</th>
                <th>ê³µì¦</th>
                <th>ì°¨ì†</th>
                <th>ì¥íƒ„</th>
                <th>ê³µê²©ë ¥</th>
                <th>ì†Œì¥í’ˆ</th>
                <th>ìŠ¤í‚¬1</th>
                <th>ìŠ¤í‚¬2</th>
                <th>ìŠ¤í‚¬3</th>
            </tr>
        </thead>
        <tbody>
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
        </tbody>
    </table>

    <script>
        // ë± êµ¬ì„± ì •ë³´ë¥¼ ë¯¸ë¦¬ ì •ì˜ (ì¶”í›„ ë±ì´ ì¶”ê°€ë  ë•Œ ìœ ì—°í•˜ê²Œ ì ìš©)
        const decks = {
            deck1: {
                name: 'ì‹ ë° ìˆ˜ë‹ˆìŠ¤ í´ì´ë“ ',
                characters: [
                    { name: 'ì‹ ë°ë ë¼', weight: 14.4, type: 'element', image: 'images/characters/si_c511_00_s.webp' },
                    { name: 'ì•„ë‹ˆìŠ¤ : ìŠ¤íŒŒí´ë§ ì„œë¨¸', weight: 4.4, type: 'element', image: 'images/characters/si_c015_00_s.webp' },
                    { name: 'ë©”ì´ë“  : ì•„ì´ìŠ¤ ë¡œì¦ˆ', weight: 6.2, type: 'element', image: 'images/characters/si_c183_00_s.webp' }
                ]
            },
            deck2: {
                name: 'í‘ì˜ ì•¨ë¦¬ìŠ¤ (í’ì••)',
                characters: [
                    { name: 'í™ë ¨ : í‘ì˜', weight: 9.5, type: 'element', image: 'images/characters/si_c225_00_s.webp' },
                    { name: 'ì•¨ë¦¬ìŠ¤', weight: 5.2, type: 'nonElement', image: 'images/characters/si_c191_00_s.webp' }
                ]
            },
            deck3: { 
                name: 'í‘ì˜ í’ìŠ¤ì¹´', //'ì„¸ì´ë Œ í‘ì˜ í’ìŠ¤ì¹´',
                characters: [
                    //{ name: 'ë¦¬í‹€ ë¨¸ë©”ì´ë“œ', weight: 1, type: 'element', image: 'images/characters/si_c513_00_s.webp' },
                    { name: 'í™ë ¨ : í‘ì˜', weight: 7, type: 'element', image: 'images/characters/si_c225_00_s.webp' },
                    { name: 'ì•„ìŠ¤ì¹´ : WILLE', weight: 8.2, type: 'element', image: 'images/characters/si_c835_00_s.webp' }
                ]
            },
            deck4: {
                name: 'ë ˆí›„ ë§¥ìŠ¤ì›°',
                characters: [
                    { name: 'ë ˆë“œ í›„ë“œ', weight: 6.8, type: 'element', image: 'images/characters/si_c470_00_s.webp' },
                    { name: 'ë§¥ìŠ¤ì›°', weight: 2.7, type: 'element', image: 'images/characters/si_c102_00_s.webp' }
                ]
            },
            deck5: {
                name: 'ë ˆí›„ ë¼í”¼', // ê´€í†µ 2íƒ€ ë°•íˆëŠ” ìŠ¤í†°ë¸Œë§ì–´ì¸ ê²½ìš°ì— weight 5.8, 7.5 ì˜€ìŒ
                characters: [
                    { name: 'ë ˆë“œ í›„ë“œ', weight: 5.8, type: 'element', image: 'images/characters/si_c470_00_s.webp' },
                    { name: 'ë¼í”¼ : ë ˆë“œ í›„ë“œ', weight: 7.5, type: 'element', image: 'images/characters/si_c016_00_s.webp' }
                ]
            },
            deck6: {
                name: 'ë¼í”¼ ëª¨ë”', // ë¦¬ë¹Œë“œ ì¿ ì¿°ë²„ ê¸°ì¤€ìœ¼ë¡œ weight
                characters: [
                    { name: 'ë¼í”¼ : ë ˆë“œ í›„ë“œ', weight: 7, type: 'element', image: 'images/characters/si_c016_00_s.webp' },
                    { name: 'ëª¨ë”ë‹ˆì•„', weight: 6, type: 'element', image: 'images/characters/si_c260_00_s.webp' }
                ]
            },
            // deck7: { // weight ì¡°ì •
            //     name: 'ë¼í”¼ ì•¨ë¦¬ìŠ¤',
            //     characters: [
            //         { name: 'ë¼í”¼ : ë ˆë“œ í›„ë“œ', weight: 1, type: 'element', image: 'images/characters/si_c016_00_s.webp' },
            //         { name: 'ì•¨ë¦¬ìŠ¤', weight: 1, type: 'element', image: 'images/characters/si_c191_00_s.webp' }
            //     ]
            // },
            // deck8: { // weight ì¡°ì •
            //     name: 'ì•„ìŠ¤ì¹´ ë ˆì´ ëª¨ë”',
            //     characters: [
            //         { name: 'ì•„ìŠ¤ì¹´', weight: 1, type: 'element', image: 'images/characters/si_c830_00_s.webp' },
            //         { name: 'ë ˆì´', weight: 1, type: 'element', image: 'images/characters/si_c831_00_s.webp' },
            //         { name: 'ëª¨ë”ë‹ˆì•„', weight: 1, type: 'element', image: 'images/characters/si_c260_00_s.webp' }
            //     ]
            // },
            deck9: { // weight ì¡°ì •
                name: 'í—¬ë¦„ í´ë£¨ë“œ', // í† ì»¤í‹°ë¸Œ (ì½”ì–´ìˆìŒ) ê¸°ì¤€ìœ¼ë¡œ weight
                characters: [
                    { name: 'í—¬ë¦„', weight: 6.1, type: 'element', image: 'images/characters/si_c352_00_s.webp' },
                    { name: 'ë£¨ë“œë°€ë¼ : ìœˆí„° ì˜¤ë„ˆ', weight: 5.4, type: 'element', image: 'images/characters/si_c194_00_s.webp' }
                ]
            }
        };

        fetch('data/data.json')
            .then(response => response.json())
            .then(data => {
                const seasonSelect = document.getElementById('seasonSelect');
                const seasons = Object.keys(data.seasons).sort((a, b) => b - a); // ìˆ«ì ë‚´ë¦¼ì°¨ìˆœ
                seasons.forEach(season => {
                    const option = document.createElement('option');
                    option.value = season;
                    option.textContent = `ì‹œì¦Œ ${season}`;
                    seasonSelect.appendChild(option);
                });

                let members = data.seasons[seasons[0]].members; // ìµœì‹  ì‹œì¦Œìœ¼ë¡œ ê¸°ë³¸ ì„¤ì •

                seasonSelect.addEventListener('change', () => {
                    const selectedSeason = seasonSelect.value;
                    members = data.seasons[selectedSeason].members;
                    updateTable(); // í…Œì´ë¸”ì„ ë‹¤ì‹œ ê·¸ë¦½ë‹ˆë‹¤
                });

                const selectDeck = document.getElementById('deckSelect');
                const selectCharacter = document.getElementById('characterSelect');
                const selectMember = document.getElementById('memberSelect');
                const selectSort = document.getElementById('sortSelect');
                const tbody = document.getElementById('statsTable').querySelector('tbody');
                const tableHeader = document.getElementById('tableHeader');
                const deckMemberSelect = document.getElementById('deckMemberSelect');
                const deckDamageInput = document.getElementById('deckDamageInput');

                // ê°œë³„ ëª¨ë“œìš© ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°: ìºë¦­í„°, ë©¤ë²„ ëª©ë¡
                const characterNamesSet = new Set();
                const memberNamesSet = [];

                members.sort((a, b) => b.syncroLevel - a.syncroLevel).forEach(member => {
                    memberNamesSet.push({ name: member.name, syncroLevel: member.syncroLevel });
                    member.characters.forEach(character => {
                        characterNamesSet.add(character.name);
                    });
                });

                // íŠ¹ì • ìºë¦­í„°ë¥¼ ìµœìƒë‹¨ì— ìœ„ì¹˜ì‹œí‚¤ê¸°
                const priorityCharacters = [
                    // ì „ê²©
                    "ğŸ’œ ì‹ ë°ë ë¼",
                    "ğŸ’œ ì•„ë‹ˆìŠ¤ : ìŠ¤íŒŒí´ë§ ì„œë¨¸",
                    "ğŸ’œ ë©”ì´ë“  : ì•„ì´ìŠ¤ ë¡œì¦ˆ",                     
                    // í’ì••
                    "ğŸ’š í™ë ¨ : í‘ì˜", 
                    "ğŸ’š ì•„ìŠ¤ì¹´ : WILLE",
                    "ğŸ’š ë ˆì´ (ê°€ì¹­)",
                    "ğŸ’š ë¦¬í‹€ ë¨¸ë©”ì´ë“œ",
                    // ì‘ì—´
                    "â¤ï¸ ì•¨ë¦¬ìŠ¤", 
                    "â¤ï¸ ë¯¸í•˜ë¼ : ë³¸ë”© ì²´ì¸",
                    "â¤ï¸ ì•„ìŠ¤ì¹´",
                    "â¤ï¸ ë ˆì´",
                    "â¤ï¸ ëª¨ë”ë‹ˆì•„",
                    // ì² ê°‘
                    "ğŸ’› ë¼í”¼ : ë ˆë“œ í›„ë“œ", 
                    "ğŸ’› ë ˆë“œ í›„ë“œ",
                    "ğŸ’› ì´ë¸Œ",
                    "ğŸ’› ë ˆì´ë¸",
                    "ğŸ’› ìŠ¤ë…¸ìš° í™”ì´íŠ¸",
                    // ìˆ˜ëƒ‰
                    "ğŸ’™ ë„ë¡œì‹œ : ì„¸ë Œë””í”¼í‹°", 
                    "ğŸ’™ í—¬ë¦„", 
                    "ğŸ’™ ë£¨ë“œë°€ë¼ : ìœˆí„° ì˜¤ë„ˆ",
                    "ğŸ’™ ì¼ë ˆê·¸ : ë¶ ì•¤ ì‡¼í¬",
                    "ğŸ’™ í€€ì‹œ : ì´ìŠ¤ì¼€ì´í”„ í€¸",
                    "ğŸ’™ ë¸Œë˜ë””",
                ];

                // priorityCharacters ë°°ì—´ ìœ„ì— element ë§¤í•‘ ì¶”ê°€
                const elementEmojis = {
                    "ì „ê²©": "ğŸŸª",
                    "ì² ê°‘": "ğŸŸ¨",
                    "ì‘ì—´": "ğŸŸ¥", 
                    "ìˆ˜ëƒ‰": "ğŸŸ¦",
                    "í’ì••": "ğŸŸ©"
                };
                
                // ìš°ì„ ìˆœìœ„ ìºë¦­í„°ë¥¼ ë¨¼ì € ì¶”ê°€
                priorityCharacters.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name.slice(3); // ì´ëª¨ì§€ ì œê±°
                    option.innerHTML = name;
                    selectCharacter.appendChild(option);
                });

                const sortedCharacters = Array.from(characterNamesSet)
                    .sort()
                    .filter(name => !priorityCharacters.includes(name)); // ìš°ì„ ìˆœìœ„ ìºë¦­í„° ì œì™¸

                // ë‚˜ë¨¸ì§€ ìºë¦­í„°ë¥¼ ì´ë¦„ ìˆœìœ¼ë¡œ ì¶”ê°€
                sortedCharacters.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    selectCharacter.appendChild(option);
                });

                memberNamesSet.forEach(member => {
                    const option = document.createElement('option');
                    option.value = member.name;
                    option.textContent = `${member.name} (${member.syncroLevel})`;
                    selectMember.appendChild(option);
                });

                function updateDeckMemberSelect() {
                    // í˜„ì¬ ì„ íƒëœ ê°’ ì €ì¥
                    const prevValue = deckMemberSelect.value;
                    deckMemberSelect.innerHTML = '<option value="">-- ë©¤ë²„ ì„ íƒ --</option>';
                    members.forEach(member => {
                        const option = document.createElement('option');
                        option.value = member.name;
                        option.textContent = `${member.name} (${member.syncroLevel})`;
                        deckMemberSelect.appendChild(option);
                    });
                    // ì´ì „ ì„ íƒê°’ ë³µì›
                    if (prevValue) deckMemberSelect.value = prevValue;
                }

                // ê°œë³„ ëª¨ë“œ í—¤ë” ì—…ë°ì´íŠ¸ (ì •ë ¬ ê¸°ì¤€ ì»¬ëŸ¼ ìš°ì¸¡ì— â–¼ í‘œì‹œ)
                function updateNormalHeader(sortBy, showNickname, showCharacter) {
                    tableHeader.innerHTML = `<tr>
                        <th>ìˆœìœ„</th>
                        ${showNickname ? `<th class="nickname-col">ë‹‰ë„¤ì„</th>` : ""}
                        ${showCharacter ? `<th class="character-col">ìºë¦­í„°</th>` : ""}
                        <th>ìœ¡ì„±</th>
                        <th>ìš°ì½” íŒŒì›Œ</th>
                        <th>ë¹„ìš°ì½” íŒŒì›Œ</th>
                        <th>ìš°ì½”xê³µì¦</th>
                        <th>ìš°ì½”</th>
                        <th>ê³µì¦</th>
                        <th>ì°¨ì†</th>
                        <th>ì¥íƒ„</th>
                        <th>ê³µê²©ë ¥</th>
                        <th>ì†Œì¥í’ˆ</th>
                        <th>ìŠ¤í‚¬1</th>
                        <th>ìŠ¤í‚¬2</th>
                        <th>ìŠ¤í‚¬3</th>
                        </tr>`;
                    const headers = {
                        "elementPower": "ìš°ì½” íŒŒì›Œ",
                        "nonElementPower": "ë¹„ìš°ì½” íŒŒì›Œ",
                        "elementPlusAtk": "ìš°ì½”xê³µì¦",
                        "increaseElementDamage": "ìš°ì½”",
                        "increaseAtk": "ê³µì¦",
                        "trainingLevel": "ìœ¡ì„±"
                    };
                    tableHeader.querySelectorAll("th").forEach(th => {
                        if (th.textContent === headers[sortBy]) {
                            th.textContent += " â–¼";
                        }
                    });
                }

                // ë± ëª¨ë“œìš© í—¤ë” ì—…ë°ì´íŠ¸ (ë‹¨ì¼ í–‰ í—¤ë”)
                function updateDeckHeader(showDamageCol = false) {
                    // í—¤ë”: ìˆœìœ„, ë‹‰ë„¤ì„, ë± íŒŒì›Œ, ìºë¦­í„°, ìš°ì½” íŒŒì›Œ, ë¹„ìš°ì½” íŒŒì›Œ, ìš°ì½”xê³µì¦, ìš°ì½”, ê³µì¦, ê³µê²©ë ¥, ìŠ¤í‚¬1, ìŠ¤í‚¬2, ìŠ¤í‚¬3
                    // ë± ëª¨ë“œì—ì„œëŠ” ìˆœìœ„, ë‹‰ë„¤ì„, ë± íŒŒì›Œ ì…€ì€ ë³‘í•©(ì—¬ëŸ¬ í–‰ì— ê±¸ì³ ë³´ì—¬ì§)
                    tableHeader.innerHTML = `<tr>
              <th rowspan="2">ìˆœìœ„</th>
              <th rowspan="2">ë‹‰ë„¤ì„</th>
              <th rowspan="2">ë± íŒŒì›Œ â–¼</th>
              ${showDamageCol ? '<th rowspan="2">ì˜ˆìƒ ëŒ€ë¯¸ì§€</th>' : ''}
              <th>ìºë¦­í„°</th>
              <th>ìœ¡ì„±</th>
              <th>ìš°ì½” íŒŒì›Œ</th>
              <th>ë¹„ìš°ì½” íŒŒì›Œ</th>
              <th>ìš°ì½”xê³µì¦</th>
              <th>ìš°ì½”</th>
              <th>ê³µì¦</th>
              <th>ì°¨ì†</th>
              <th>ì¥íƒ„</th>
              <th>ê³µê²©ë ¥</th>
              <th>ì†Œì¥í’ˆ</th>
              <th>ìŠ¤í‚¬1</th>
              <th>ìŠ¤í‚¬2</th>
              <th>ìŠ¤í‚¬3</th>
            </tr>`;
                    // ë‘ ë²ˆì§¸ í–‰ì€ ì‹¤ì œ í—¤ë”ëŠ” ê·¸ëŒ€ë¡œ í‘œì‹œí•˜ì§€ ì•ŠìŒ â€“ ë°ì´í„° í–‰ì—ì„œ ê° ë± ìºë¦­í„°ë³„ë¡œ ì¶œë ¥ë©ë‹ˆë‹¤.
                }

                // updateTable í•¨ìˆ˜: ë± ëª¨ë“œì™€ ê°œë³„ ëª¨ë“œë¥¼ ëª¨ë‘ ì§€ì›
                function updateTable() {
                    const deckMode = selectDeck.value !== "";
                    const selectedCharacter = selectCharacter.value;
                    const selectedMember = selectMember.value;
                    const sortBy = selectSort.value;
                    tbody.innerHTML = "";
                    updateDeckMemberSelect();

                    if (deckMode) {
                        // ë± ëª¨ë“œ: ë±ì— ì •ì˜ëœ ëª¨ë“  ìºë¦­í„°ë¥¼ ë³´ìœ í•œ ë©¤ë²„ë§Œ í‘œì‹œ
                        const deck = decks[selectDeck.value];
                        let deckData = [];
                        members.forEach(member => {
                            let deckStats = [];
                            let hasAll = true;
                            deck.characters.forEach(deckChar => {
                                const charData = member.characters.find(c => c.name === deckChar.name);
                                if (charData) {
                                    // ê° ìºë¦­í„°ë³„ ê³„ì‚°
                                    const elementPower = Math.round(charData.atk * (1 + charData.increaseAtk / 200) * (1 + charData.increaseElementDamage / 100));
                                    const nonElementPower = Math.round(charData.atk * (1 + charData.increaseAtk / 200));
                                    const elementPlusAtk = Math.round(((1 + charData.increaseAtk / 200) * (1 + charData.increaseElementDamage / 100) - 1) * 10000) / 100;
                                    deckStats.push({
                                        characterName: deckChar.name,
                                        elementPower: elementPower,
                                        nonElementPower: nonElementPower,
                                        elementPlusAtk: elementPlusAtk,
                                        increaseElementDamage: charData.increaseElementDamage,
                                        increaseAtk: charData.increaseAtk,
                                        increaseChargeSpeed: charData.increaseChargeSpeed,
                                        increaseMaxAmmunitionCapacity: charData.increaseMaxAmmunitionCapacity,
                                        atk: charData.atk,
                                        skill1: charData.skill1,
                                        skill2: charData.skill2,
                                        skill3: charData.skill3,
                                        weight: deckChar.weight,
                                        type: deckChar.type,
                                        image: deckChar.image,
                                        itemGrade: charData.itemGrade,
                                        itemLevel: charData.itemLevel,
                                        trainingLevel: elementPlusAtk,
                                        element: charData.element,
                                    });
                                } else {
                                    hasAll = false;
                                }
                            });
                            if (hasAll && deckStats.length > 0) {
                                if (deck.name === 'ì‹ ë° ìˆ˜ë‹ˆìŠ¤ í´ì´ë“ ') {
                                    const cinde = deckStats.find(c => c.characterName === "ì‹ ë°ë ë¼");
                                    const sunis = deckStats.find(c => c.characterName === "ì•„ë‹ˆìŠ¤ : ìŠ¤íŒŒí´ë§ ì„œë¨¸");
                                    const chrismasMaiden = deckStats.find(c => c.characterName === "ë©”ì´ë“  : ì•„ì´ìŠ¤ ë¡œì¦ˆ");

                                    const cindeRealElementPower = Math.round((cinde.atk * (1 + cinde.increaseAtk / 100) + (sunis.atk * 1.1) + (chrismasMaiden.atk * 0.4)) * (1 + cinde.increaseElementDamage / 100));
                                    const deckPower = Math.round(16 * cindeRealElementPower + 5 * sunis.elementPower + 6 * chrismasMaiden.elementPower);
                                    
                                    deckData.push({
                                        memberName: member.name,
                                        deckPower: deckPower,
                                        deckStats: deckStats
                                    });
                                }
                                else {
                                    // ë± íŒŒì›Œ: ê° ìºë¦­í„°ì˜ ìš°ì½” íŒŒì›Œ í•©ê³„
                                    const deckPower = deckStats.reduce((sum, curr) => sum + (Math.round((curr.type === "element" ? curr.elementPower : curr.nonElementPower) * curr.weight)), 0);
                                    deckData.push({
                                        memberName: member.name,
                                        deckPower: deckPower,
                                        deckStats: deckStats
                                    });
                                }
                            }
                        });
                        deckData.sort((a, b) => b.deckPower - a.deckPower);
                        
                        let showDamageCol = false;
                        let selectedDeckMember = deckMemberSelect.value;
                        let inputDamage = parseFloat(deckDamageInput.value);
                        let selectedDeckMemberPower = null;
                        if (selectedDeckMember && !isNaN(inputDamage) && inputDamage > 0) {
                            const found = deckData.find(d => d.memberName === selectedDeckMember);
                            if (found) {
                                selectedDeckMemberPower = found.deckPower;
                                showDamageCol = true;
                            }
                        }

                        updateDeckHeader(showDamageCol);
                        
                        deckData.forEach((data, index) => {
                            const rowCount = data.deckStats.length;

                            let damageValue = '';
                            if (showDamageCol && selectedDeckMemberPower) {
                                damageValue = Math.round((inputDamage / selectedDeckMemberPower) * data.deckPower);
                            }
                            
                            data.deckStats.forEach((stat, i) => {
                                const tr = document.createElement("tr");
                                if (i === 0)
                                {
                                    tr.innerHTML = `<td rowspan="${rowCount}">${index + 1}</td>
                    <td rowspan="${rowCount}">${data.memberName}</td>
                    <td rowspan="${rowCount}">${data.deckPower.toLocaleString()}</td>
                    ${showDamageCol ? `<td rowspan="${rowCount}">${damageValue.toLocaleString()}</td>` : ""}
                    <td>
                        <div class="character-container">
                            <img src="${stat.image}" class="character-image" alt="${stat.characterName}">
                            <span class="character-name">${stat.element !== "" ? (elementEmojis[stat.element] + ' ') : ''} ${stat.characterName}</span>
                        </div>
                    </td>
                    <td>${stat.trainingLevel >= 80 ? 'ğŸ”´' : 
                        stat.trainingLevel >= 60 ? 'ğŸŸ ' : 
                        stat.trainingLevel >= 40 ? 'ğŸŸ¡' : ''}</td>
                    <td>${stat.elementPower.toLocaleString()}</td>
                    <td>${stat.nonElementPower.toLocaleString()}</td>
                    <td>${stat.elementPlusAtk}</td>
                    <td>${stat.increaseElementDamage}</td>                    
                    <td>${stat.increaseAtk}</td>
                    <td${stat.characterName === "ì•¨ë¦¬ìŠ¤" && stat.increaseChargeSpeed <= 8 ? ` style="color:red"` : ""}>${stat.increaseChargeSpeed}</td>
                    <td>${stat.increaseMaxAmmunitionCapacity}</td>
                    <td>${stat.atk.toLocaleString()}</td>
                    <td>${(stat.itemGrade !== undefined && stat.itemGrade !== '' && stat.itemLevel !== undefined) ? `<span class="item-grade-${stat.itemGrade}">${stat.itemGrade} ${stat.itemLevel}</span>` : ''}</td>
                    <td>${stat.skill1}</td>
                    <td>${stat.skill2}</td>
                    <td>${stat.skill3}</td>`;
                                }
                                else
                                {
                                    tr.innerHTML = `<td>
                        <div class="character-container">
                            <img src="${stat.image}" class="character-image" alt="${stat.characterName}">
                            <span class="character-name">${stat.element !== "" ? (elementEmojis[stat.element] + ' ') : ''} ${stat.characterName}</span>
                        </div>
                    </td>
                    <td>${stat.trainingLevel >= 80 ? 'ğŸ”´' : 
                        stat.trainingLevel >= 60 ? 'ğŸŸ ' : 
                        stat.trainingLevel >= 40 ? 'ğŸŸ¡' : ''}</td>
                    <td>${stat.elementPower.toLocaleString()}</td>
                    <td>${stat.nonElementPower.toLocaleString()}</td>
                    <td>${stat.elementPlusAtk}</td>
                    <td>${stat.increaseElementDamage}</td>
                    <td>${stat.increaseAtk}</td>
                    <td${stat.characterName === "ì•¨ë¦¬ìŠ¤" && stat.increaseChargeSpeed <= 8 ? ` style="color:red"` : ""}>${stat.increaseChargeSpeed}</td>
                    <td>${stat.increaseMaxAmmunitionCapacity}</td>
                    <td>${stat.atk.toLocaleString()}</td>
                    <td>${(stat.itemGrade !== undefined && stat.itemGrade !== '' && stat.itemLevel !== undefined) ? `<span class="item-grade-${stat.itemGrade}">${stat.itemGrade} ${stat.itemLevel}</span>` : ''}</td>
                    <td>${stat.skill1}</td>
                    <td>${stat.skill2}</td>
                    <td>${stat.skill3}</td>`;
                                }
                                tbody.appendChild(tr);
                            });
                        });
                    } else {
                        // ê°œë³„ ëª¨ë“œ: ê¸°ì¡´ í•„í„°(ìºë¦­í„°, ë©¤ë²„ ì„ íƒ) ë° ì •ë ¬ ê¸°ëŠ¥ ì ìš©
                        let selectedData = [];
                        members.forEach(member => {
                            member.characters.forEach(character => {
                                if ((selectedCharacter && character.name !== selectedCharacter) ||
                                    (selectedMember && member.name !== selectedMember)) {
                                    return;
                                }
                                const elementPlusAtk = Math.round(((1 + character.increaseAtk / 200) * (1 + character.increaseElementDamage / 100) - 1) * 10000) / 100;
                                selectedData.push({
                                    memberName: member.name,
                                    characterName: character.name,
                                    elementPower: Math.round(character.atk * (1 + character.increaseAtk / 200) * (1 + character.increaseElementDamage / 100)),
                                    nonElementPower: Math.round(character.atk * (1 + character.increaseAtk / 200)),
                                    elementPlusAtk: Math.round(((1 + character.increaseAtk / 200) * (1 + character.increaseElementDamage / 100) - 1) * 10000) / 100,
                                    increaseElementDamage: character.increaseElementDamage,
                                    increaseAtk: character.increaseAtk,
                                    increaseChargeSpeed: character.increaseChargeSpeed,
                                    increaseMaxAmmunitionCapacity: character.increaseMaxAmmunitionCapacity,
                                    atk: character.atk,
                                    skill1: character.skill1,
                                    skill2: character.skill2,
                                    skill3: character.skill3,
                                    itemGrade: character.itemGrade,
                                    itemLevel: character.itemLevel,
                                    trainingLevel: elementPlusAtk,
                                    element: character.element,
                                });
                            });
                        });
                        selectedData.sort((a, b) => b[sortBy] - a[sortBy]);

                        const showNickname = selectedMember ? false : true;
                        const showCharacter = selectedCharacter ? false : true;

                        updateNormalHeader(sortBy, showNickname, showCharacter);

                        selectedData.forEach((data, index) => {
                            const tr = document.createElement("tr");
                            tr.innerHTML = `
                <td>${index + 1}</td>
                ${showNickname ? `<td>${data.memberName}</td>` : ""}
                ${showCharacter ? `<td>${data.element ? (elementEmojis[data.element] + ' ') : ''} ${data.characterName}</td>` : ""}
                <td>${data.trainingLevel >= 80 ? 'ğŸ”´' : 
                    data.trainingLevel >= 60 ? 'ğŸŸ ' : 
                    data.trainingLevel >= 40 ? 'ğŸŸ¡' : ''}</td>
                <td>${data.elementPower.toLocaleString()}</td>
                <td>${data.nonElementPower.toLocaleString()}</td>
                <td>${data.elementPlusAtk}</td>
                <td>${data.increaseElementDamage}</td>
                <td>${data.increaseAtk}</td>
                <td${data.characterName === "ì•¨ë¦¬ìŠ¤" && data.increaseChargeSpeed <= 8 ? ` style="color:red"` : ""}>${data.increaseChargeSpeed}</td>
                <td>${data.increaseMaxAmmunitionCapacity}</td>
                <td>${data.atk.toLocaleString()}</td>
                <td>${(data.itemGrade !== undefined && data.itemGrade !== '' && data.itemLevel !== undefined) ? `<span class="item-grade-${data.itemGrade}">${data.itemGrade} ${data.itemLevel}</span>` : ''}</td>
                <td>${data.skill1}</td>
                <td>${data.skill2}</td>
                <td>${data.skill3}</td>
              `;
                            tbody.appendChild(tr);
                        });
                    }
                }

                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                selectDeck.addEventListener("change", updateTable);
                selectCharacter.addEventListener("change", updateTable);
                selectMember.addEventListener("change", updateTable);
                selectSort.addEventListener("change", updateTable);
                deckMemberSelect.addEventListener("change", updateTable);
                deckDamageInput.addEventListener("input", updateTable);

                // ì´ˆê¸° í—¤ë” ì„¤ì • (ê°œë³„ ëª¨ë“œ ê¸°ë³¸)
                updateNormalHeader(selectSort.value);

                updateTable(); // ì´ˆê¸° í…Œì´ë¸” ì—…ë°ì´íŠ¸
            })
            .catch(error => console.error("JSON íŒŒì¼ ë¡œë”© ì¤‘ ì˜¤ë¥˜:", error));
    </script>
</body>

</html>