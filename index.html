<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>ìºë¦­í„° ìŠ¤íƒ¯ í…Œì´ë¸”</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f9f9f9;
            --card-bg: #ffffff;
            --text-color: #333333;
            --header-bg: #3498db;
            --header-text: #ffffff;
            --hover-bg: #f1f7ff;
            --border-color: #e0e0e0;
        }

        [data-theme="dark"] {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #eeeeee;
            --header-bg: #3498db;
            --header-text: #ffffff;
            --hover-bg: #2c2c2c;
            --border-color: #333333;
        }

        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }

        h1 {
            text-align: center;
            color: var(--text-color);
            margin-bottom: 30px;
        }

        div.controls {
            margin-bottom: 20px;
            text-align: center;
        }

        label {
            margin-right: 8px;
            font-weight: 600;
        }

        select,
        button {
            padding: 8px 12px;
            margin-right: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: border-color 0.3s, background-color 0.3s, color 0.3s;
        }

        select:focus,
        button:focus {
            border-color: #3498db;
            outline: none;
        }

        table {
            width: 95%;
            margin: 0 auto;
            border-collapse: collapse;
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        th,
        td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--header-bg);
            color: var(--header-text);
            font-weight: 600;
            font-size: 14px;
        }

        tr:hover {
            background-color: var(--hover-bg);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }
    </style>
</head>

<body>
    <h1>ìºë¦­í„° ìŠ¤íƒ¯ ì¡°íšŒ</h1>
    <div>
        <label for="seasonSelect">ì‹œì¦Œ ì„ íƒ: </label>
        <select id="seasonSelect"></select>
    </div>
    <div>
        <!-- ë± ì„ íƒ: ë± ëª¨ë“œ ì „í™˜ (ì˜µì…˜ í…ìŠ¤íŠ¸ëŠ” 'ì‹ ìˆ˜í´') -->
        <label for="deckSelect">ë± ì„ íƒ: </label>
        <select id="deckSelect">
            <option value="">-- ë± ì„ íƒ --</option>
            <option value="deck1">ì‹ ìˆ˜í´</option>
            <option value="deck2">í‘ì•¨ (í’ì••)</option>
            <option value="deck3">ë ˆë§¥</option>
            <option value="deck4">ë ˆë¼(3ë²„)</option>
            <option value="deck5">ë¼(1ë²„)ë ˆë§¥</option>
        </select>
    </div>
    <div>
        <!-- ê°œë³„ ëª¨ë“œìš© ë“œë¡­ë‹¤ìš´ -->
        <label for="characterSelect">ìºë¦­í„° ì„ íƒ: </label>
        <select id="characterSelect">
            <option value="">-- ìºë¦­í„° ì„ íƒíƒ --</option>
        </select>

        <label for="memberSelect">ë©¤ë²„ ì„ íƒ: </label>
        <select id="memberSelect">
            <option value="">-- ë©¤ë²„ ì„ íƒ --</option>
        </select>

        <!-- ì •ë ¬ ê¸°ì¤€ (ê°œë³„ ëª¨ë“œì— ì ìš©, ë± ëª¨ë“œì—ì„œëŠ” ë± íŒŒì›Œ ê¸°ì¤€ ì •ë ¬) -->
        <label for="sortSelect">ì •ë ¬ ê¸°ì¤€: </label>
        <select id="sortSelect">
            <option value="elementPower">ìš°ì½” íŒŒì›Œ</option>
            <option value="nonElementPower">ë¹„ìš°ì½” íŒŒì›Œ</option>
            <option value="elementPlusAtk">ìš°ì½”xê³µì¦</option>
            <option value="increaseElementDamage">ìš°ì½”</option>
            <option value="increaseAtk">ê³µì¦</option>
        </select>

        <button onclick="toggleDarkMode()">ğŸŒ™ / â˜€ï¸</button>
    </div>

    <!-- ìŠ¤íƒ¯ ì¶œë ¥ í…Œì´ë¸” -->
    <table id="statsTable">
        <thead id="tableHeader">
            <!-- ê¸°ë³¸ ê°œë³„ ëª¨ë“œ í—¤ë” (ë± ëª¨ë“œê°€ ì•„ë‹ ê²½ìš°) -->
            <tr>
                <th>ìˆœìœ„</th>
                <th class="nickname-col">ë‹‰ë„¤ì„</th>
                <th class="character-col">ìºë¦­í„°</th>
                <th>ìš°ì½” íŒŒì›Œ</th>
                <th>ë¹„ìš°ì½” íŒŒì›Œ</th>
                <th>ìš°ì½”xê³µì¦</th>
                <th>ìš°ì½”</th>
                <th>ê³µì¦</th>
                <th>ì°¨ì†</th>
                <th>ì¥íƒ„</th>
                <th>ê³µê²©ë ¥</th>
                <th>ìŠ¤í‚¬1</th>
                <th>ìŠ¤í‚¬2</th>
                <th>ìŠ¤í‚¬3</th>
            </tr>
        </thead>
        <tbody>
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
        </tbody>
    </table>

    <script>
        // ë± êµ¬ì„± ì •ë³´ë¥¼ ë¯¸ë¦¬ ì •ì˜ (ì¶”í›„ ë±ì´ ì¶”ê°€ë  ë•Œ ìœ ì—°í•˜ê²Œ ì ìš©)
        const decks = {
            deck1: {
                // ë± ì„ íƒ ì˜µì…˜ì—ì„œ ë³´ì—¬ì§ˆ í…ìŠ¤íŠ¸ëŠ” 'ì‹ ìˆ˜í´'
                name: 'ì‹ ìˆ˜í´',
                // ë‚´ë¶€ì ìœ¼ë¡œ í¬í•¨ëœ ìºë¦­í„° ë°°ì—´ (ê°¯ìˆ˜ëŠ” ë³€ë™ ê°€ëŠ¥)
                characters: [
                    { name: 'ì‹ ë°ë ë¼', weight: 14.4, type: 'element' },
                    { name: 'ì•„ë‹ˆìŠ¤ : ìŠ¤íŒŒí´ë§ ì„œë¨¸', weight: 4.4, type: 'element' },
                    { name: 'ë©”ì´ë“  : ì•„ì´ìŠ¤ ë¡œì¦ˆ', weight: 6.2, type: 'element' }
                ]
            },
            deck2: {
                name: 'í‘ì•¨ (í’ì••)',
                characters: [
                    { name: 'í™ë ¨ : í‘ì˜', weight: 9.5, type: 'element' },
                    { name: 'ì•¨ë¦¬ìŠ¤', weight: 5.2, type: 'nonElement' }
                ]
            },
            deck3: {
                name: 'ë ˆë§¥',
                characters: [
                    { name: 'ë ˆë“œ í›„ë“œ', weight: 6.8, type: 'element' },
                    { name: 'ë§¥ìŠ¤ì›°', weight: 2.7, type: 'element' }
                ]
            },
            deck4: {
                name: 'ë ˆë¼(3ë²„)',
                characters: [
                    { name: 'ë ˆë“œ í›„ë“œ', weight: 5.8, type: 'element' },
                    { name: 'ë¼í”¼ : ë ˆë“œ í›„ë“œ', weight: 7.5, type: 'element' }
                ]
            },
            deck5: {
                name: 'ë¼(1ë²„)ë ˆë§¥',
                characters: [
                    { name: 'ë¼í”¼ : ë ˆë“œ í›„ë“œ', weight: 4.1, type: 'element' },
                    { name: 'ë ˆë“œ í›„ë“œ', weight: 7, type: 'element' },
                    { name: 'ë§¥ìŠ¤ì›°', weight: 2.2, type: 'element' }
                ]
            }
        };

        fetch('data/data.json')
            .then(response => response.json())
            .then(data => {
                const seasonSelect = document.getElementById('seasonSelect');
                const seasons = Object.keys(data.seasons).sort((a, b) => b - a); // ìˆ«ì ë‚´ë¦¼ì°¨ìˆœ
                seasons.forEach(season => {
                    const option = document.createElement('option');
                    option.value = season;
                    option.textContent = `ì‹œì¦Œ ${season}`;
                    seasonSelect.appendChild(option);
                });

                let members = data.seasons[seasons[0]].members; // ìµœì‹  ì‹œì¦Œìœ¼ë¡œ ê¸°ë³¸ ì„¤ì •

                seasonSelect.addEventListener('change', () => {
                    const selectedSeason = seasonSelect.value;
                    members = data.seasons[selectedSeason].members;
                    updateTable(); // í…Œì´ë¸”ì„ ë‹¤ì‹œ ê·¸ë¦½ë‹ˆë‹¤
                });

                const selectDeck = document.getElementById('deckSelect');
                const selectCharacter = document.getElementById('characterSelect');
                const selectMember = document.getElementById('memberSelect');
                const selectSort = document.getElementById('sortSelect');
                const tbody = document.getElementById('statsTable').querySelector('tbody');
                const tableHeader = document.getElementById('tableHeader');

                // ê°œë³„ ëª¨ë“œìš© ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°: ìºë¦­í„°, ë©¤ë²„ ëª©ë¡
                const characterNamesSet = new Set();
                const memberNamesSet = new Set();
                members.forEach(member => {
                    memberNamesSet.add(member.name);
                    member.characters.forEach(character => {
                        characterNamesSet.add(character.name);
                    });
                });
                Array.from(characterNamesSet).sort().forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    selectCharacter.appendChild(option);
                });
                Array.from(memberNamesSet).sort().forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    selectMember.appendChild(option);
                });

                // ê°œë³„ ëª¨ë“œ í—¤ë” ì—…ë°ì´íŠ¸ (ì •ë ¬ ê¸°ì¤€ ì»¬ëŸ¼ ìš°ì¸¡ì— â–¼ í‘œì‹œ)
                function updateNormalHeader(sortBy, showNickname, showCharacter) {
                    tableHeader.innerHTML = `<tr>
                        <th>ìˆœìœ„</th>
                        ${showNickname ? `<th class="nickname-col">ë‹‰ë„¤ì„</th>` : ""}
                        ${showCharacter ? `<th class="character-col">ìºë¦­í„°</th>` : ""}
                        <th>ìš°ì½” íŒŒì›Œ</th>
                        <th>ë¹„ìš°ì½” íŒŒì›Œ</th>
                        <th>ìš°ì½”xê³µì¦</th>
                        <th>ìš°ì½”</th>
                        <th>ê³µì¦</th>
                        <th>ì°¨ì†</th>
                        <th>ì¥íƒ„</th>
                        <th>ê³µê²©ë ¥</th>
                        <th>ìŠ¤í‚¬1</th>
                        <th>ìŠ¤í‚¬2</th>
                        <th>ìŠ¤í‚¬3</th>
                        </tr>`;
                    const headers = {
                        "elementPower": "ìš°ì½” íŒŒì›Œ",
                        "nonElementPower": "ë¹„ìš°ì½” íŒŒì›Œ",
                        "elementPlusAtk": "ìš°ì½”xê³µì¦",
                        "increaseElementDamage": "ìš°ì½”",
                        "increaseAtk": "ê³µì¦"
                    };
                    tableHeader.querySelectorAll("th").forEach(th => {
                        if (th.textContent === headers[sortBy]) {
                            th.textContent += " â–¼";
                        }
                    });
                }

                // ë± ëª¨ë“œìš© í—¤ë” ì—…ë°ì´íŠ¸ (ë‹¨ì¼ í–‰ í—¤ë”)
                function updateDeckHeader() {
                    // í—¤ë”: ìˆœìœ„, ë‹‰ë„¤ì„, ë± íŒŒì›Œ, ìºë¦­í„°, ìš°ì½” íŒŒì›Œ, ë¹„ìš°ì½” íŒŒì›Œ, ìš°ì½”xê³µì¦, ìš°ì½”, ê³µì¦, ê³µê²©ë ¥, ìŠ¤í‚¬1, ìŠ¤í‚¬2, ìŠ¤í‚¬3
                    // ë± ëª¨ë“œì—ì„œëŠ” ìˆœìœ„, ë‹‰ë„¤ì„, ë± íŒŒì›Œ ì…€ì€ ë³‘í•©(ì—¬ëŸ¬ í–‰ì— ê±¸ì³ ë³´ì—¬ì§)
                    tableHeader.innerHTML = `<tr>
              <th rowspan="2">ìˆœìœ„</th>
              <th rowspan="2">ë‹‰ë„¤ì„</th>
              <th rowspan="2">ë± íŒŒì›Œ â–¼</th>
              <th>ìºë¦­í„°</th>
              <th>ìš°ì½” íŒŒì›Œ</th>
              <th>ë¹„ìš°ì½” íŒŒì›Œ</th>
              <th>ìš°ì½”xê³µì¦</th>
              <th>ìš°ì½”</th>
              <th>ê³µì¦</th>
              <th>ì°¨ì†</th>
              <th>ì¥íƒ„</th>
              <th>ê³µê²©ë ¥</th>
              <th>ìŠ¤í‚¬1</th>
              <th>ìŠ¤í‚¬2</th>
              <th>ìŠ¤í‚¬3</th>
            </tr>`;
                    // ë‘ ë²ˆì§¸ í–‰ì€ ì‹¤ì œ í—¤ë”ëŠ” ê·¸ëŒ€ë¡œ í‘œì‹œí•˜ì§€ ì•ŠìŒ â€“ ë°ì´í„° í–‰ì—ì„œ ê° ë± ìºë¦­í„°ë³„ë¡œ ì¶œë ¥ë©ë‹ˆë‹¤.
                }

                // updateTable í•¨ìˆ˜: ë± ëª¨ë“œì™€ ê°œë³„ ëª¨ë“œë¥¼ ëª¨ë‘ ì§€ì›
                function updateTable() {
                    const deckMode = selectDeck.value !== "";
                    const selectedCharacter = selectCharacter.value;
                    const selectedMember = selectMember.value;
                    const sortBy = selectSort.value;
                    tbody.innerHTML = "";

                    if (deckMode) {
                        // ë± ëª¨ë“œ: ë±ì— ì •ì˜ëœ ëª¨ë“  ìºë¦­í„°ë¥¼ ë³´ìœ í•œ ë©¤ë²„ë§Œ í‘œì‹œ
                        const deck = decks[selectDeck.value];
                        let deckData = [];
                        members.forEach(member => {
                            let deckStats = [];
                            let hasAll = true;
                            deck.characters.forEach(deckChar => {
                                const charData = member.characters.find(c => c.name === deckChar.name);
                                if (charData) {
                                    // ê° ìºë¦­í„°ë³„ ê³„ì‚°
                                    const elementPower = Math.round(charData.atk * (1 + charData.increaseAtk / 100) * (1 + charData.increaseElementDamage / 100));
                                    const nonElementPower = Math.round(charData.atk * (1 + charData.increaseAtk / 100));
                                    const elementPlusAtk = Math.round(((1 + charData.increaseAtk / 100) * (1 + charData.increaseElementDamage / 100) - 1) * 10000) / 100;
                                    deckStats.push({
                                        characterName: deckChar.name,
                                        elementPower: elementPower,
                                        nonElementPower: nonElementPower,
                                        elementPlusAtk: elementPlusAtk,
                                        increaseElementDamage: charData.increaseElementDamage,
                                        increaseAtk: charData.increaseAtk,
                                        increaseChargeSpeed: charData.increaseChargeSpeed,
                                        increaseMaxAmmunitionCapacity: charData.increaseMaxAmmunitionCapacity,
                                        atk: charData.atk,
                                        skill1: charData.skill1,
                                        skill2: charData.skill2,
                                        skill3: charData.skill3,
                                        weight: deckChar.weight,
                                        type: deckChar.type
                                    });
                                } else {
                                    hasAll = false;
                                }
                            });
                            if (hasAll && deckStats.length > 0) {
                                // ë± íŒŒì›Œ: ê° ìºë¦­í„°ì˜ ìš°ì½” íŒŒì›Œ í•©ê³„
                                const deckPower = deckStats.reduce((sum, curr) => sum + (Math.round((curr.type === "element" ? curr.elementPower : curr.nonElementPower) * curr.weight)), 0);
                                deckData.push({
                                    memberName: member.name,
                                    deckPower: deckPower,
                                    deckStats: deckStats
                                });
                            }
                        });
                        // ë± ëª¨ë“œì—ì„œëŠ” ë± íŒŒì›Œ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
                        deckData.sort((a, b) => b.deckPower - a.deckPower);
                        updateDeckHeader();
                        // ë°ì´í„° í–‰: ê° ë©¤ë²„ë§ˆë‹¤ deck.characters.length ê°œì˜ í–‰ì„ ì¶œë ¥í•˜ê³ ,
                        // ì²« í–‰ì— ìˆœìœ„, ë‹‰ë„¤ì„, ë± íŒŒì›Œ ì…€ì€ rowspanìœ¼ë¡œ ë³‘í•©
                        deckData.forEach((data, index) => {
                            const rowCount = data.deckStats.length;
                            data.deckStats.forEach((stat, i) => {
                                const tr = document.createElement("tr");
                                if (i === 0) {
                                    tr.innerHTML = `<td rowspan="${rowCount}">${index + 1}</td>
                    <td rowspan="${rowCount}">${data.memberName}</td>
                    <td rowspan="${rowCount}">${data.deckPower}</td>
                    <td>${stat.characterName}</td>
                    <td>${stat.elementPower}</td>
                    <td>${stat.nonElementPower}</td>
                    <td>${stat.elementPlusAtk}</td>
                    <td>${stat.increaseElementDamage}</td>                    
                    <td>${stat.increaseAtk}</td>
                    <td${stat.characterName === "ì•¨ë¦¬ìŠ¤" && stat.increaseChargeSpeed <= 8 ? ` style="color:red"` : ""}>${stat.increaseChargeSpeed}</td>
                    <td>${stat.increaseMaxAmmunitionCapacity}</td>
                    <td>${stat.atk}</td>
                    <td>${stat.skill1}</td>
                    <td>${stat.skill2}</td>
                    <td>${stat.skill3}</td>`;
                                } else {
                                    tr.innerHTML = `<td>${stat.characterName}</td>
                    <td>${stat.elementPower}</td>
                    <td>${stat.nonElementPower}</td>
                    <td>${stat.elementPlusAtk}</td>
                    <td>${stat.increaseElementDamage}</td>
                    <td>${stat.increaseAtk}</td>
                    <td${stat.characterName === "ì•¨ë¦¬ìŠ¤" && stat.increaseChargeSpeed <= 8 ? ` style="color:red"` : ""}>${stat.increaseChargeSpeed}</td>
                    <td>${stat.increaseMaxAmmunitionCapacity}</td>
                    <td>${stat.atk}</td>
                    <td>${stat.skill1}</td>
                    <td>${stat.skill2}</td>
                    <td>${stat.skill3}</td>`;
                                }
                                tbody.appendChild(tr);
                            });
                        });
                    } else {
                        // ê°œë³„ ëª¨ë“œ: ê¸°ì¡´ í•„í„°(ìºë¦­í„°, ë©¤ë²„ ì„ íƒ) ë° ì •ë ¬ ê¸°ëŠ¥ ì ìš©
                        let selectedData = [];
                        members.forEach(member => {
                            member.characters.forEach(character => {
                                if ((selectedCharacter && character.name !== selectedCharacter) ||
                                    (selectedMember && member.name !== selectedMember)) {
                                    return;
                                }
                                selectedData.push({
                                    memberName: member.name,
                                    characterName: character.name,
                                    elementPower: Math.round(character.atk * (1 + character.increaseAtk / 100) * (1 + character.increaseElementDamage / 100)),
                                    nonElementPower: Math.round(character.atk * (1 + character.increaseAtk / 100)),
                                    elementPlusAtk: Math.round(((1 + character.increaseAtk / 100) * (1 + character.increaseElementDamage / 100) - 1) * 10000) / 100,
                                    increaseElementDamage: character.increaseElementDamage,
                                    increaseAtk: character.increaseAtk,
                                    increaseChargeSpeed: character.increaseChargeSpeed,
                                    increaseMaxAmmunitionCapacity: character.increaseMaxAmmunitionCapacity,
                                    atk: character.atk,
                                    skill1: character.skill1,
                                    skill2: character.skill2,
                                    skill3: character.skill3
                                });
                            });
                        });
                        selectedData.sort((a, b) => b[sortBy] - a[sortBy]);

                        const showNickname = selectedMember ? false : true;
                        const showCharacter = selectedCharacter ? false : true;

                        updateNormalHeader(sortBy, showNickname, showCharacter);

                        selectedData.forEach((data, index) => {
                            const tr = document.createElement("tr");
                            tr.innerHTML = `
                <td>${index + 1}</td>
                ${showNickname ? `<td>${data.memberName}</td>` : ""}
                ${showCharacter ? `<td>${data.characterName}</td>` : ""}
                <td>${data.elementPower}</td>
                <td>${data.nonElementPower}</td>
                <td>${data.elementPlusAtk}</td>
                <td>${data.increaseElementDamage}</td>
                <td>${data.increaseAtk}</td>
                <td${data.characterName === "ì•¨ë¦¬ìŠ¤" && data.increaseChargeSpeed <= 8 ? ` style="color:red"` : ""}>${data.increaseChargeSpeed}</td>
                <td>${data.increaseMaxAmmunitionCapacity}</td>
                <td>${data.atk}</td>
                <td>${data.skill1}</td>
                <td>${data.skill2}</td>
                <td>${data.skill3}</td>
              `;
                            tbody.appendChild(tr);
                        });
                    }
                }

                function toggleDarkMode() {
                    if (document.documentElement.getAttribute('data-theme') === 'dark') {
                        document.documentElement.setAttribute('data-theme', 'light');
                    } else {
                        document.documentElement.setAttribute('data-theme', 'dark');
                    }
                }

                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                selectDeck.addEventListener("change", updateTable);
                selectCharacter.addEventListener("change", updateTable);
                selectMember.addEventListener("change", updateTable);
                selectSort.addEventListener("change", updateTable);
                // ì´ˆê¸° í—¤ë” ì„¤ì • (ê°œë³„ ëª¨ë“œ ê¸°ë³¸)
                updateNormalHeader(selectSort.value);
            })
            .catch(error => console.error("JSON íŒŒì¼ ë¡œë”© ì¤‘ ì˜¤ë¥˜:", error));
    </script>
</body>

</html>